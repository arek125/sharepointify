import{d as O,r as V,c as B,w as te,o as T,a as F,b as f,e as v,f as U,g as N,F as Q,h as D,i as c,V as H,j as q,k as E,l as $,m as z,n as le,v as ae,p as oe,_ as P,q as se,s as j,t as ne,u as ie,x as re,y as ue,z as ce,A as de,B as me,C as M,D as pe,E as R,G as ve,H as fe,I as ye,J as b,K as he,L as G,M as ke,N as x,O as ge,P as _e}from"./index-0545ea52.js";import{u as J,V as be,a as A,b as K}from"./VSpacer-c35aaf9f.js";const Ve=v("th",null,null,-1),Te=v("th",null,"(",-1),Ce=v("th",{class:"text-left"}," Column ",-1),Ie=v("th",{class:"text-left"}," Operator ",-1),Be=v("th",{class:"text-left"}," Value ",-1),Le=v("th",null,")",-1),Ue={key:0,class:"text-left"},we={key:0},Ne=O({__name:"dynamicFilters",props:{visibleColumns:{type:Array,required:!0}},emits:["newSearchQuery"],setup(o,{expose:y,emit:u}){const m=o,s=V([]);let h;const p=t=>{var e;return(e=m.visibleColumns.find(a=>a.key==t))==null?void 0:e.type},I=t=>{let e=p(t);return console.log(e,t),e=="Number"||e=="DateTime"?[{title:"Equals (==)",value:"Equal"},{title:"Not equals (!=)",value:"Not equal"},{title:"Greater than(>)",value:"Greater than"},{title:"Less then(<)",value:"Less then"},{title:"Is null",value:"Is null"}]:[{title:"Contains",value:"Contains"},{title:"Equals (==)",value:"Equal"},{title:"Not equals (!=)",value:"Not equal"},{title:"Is null",value:"Is null"}]},k=B(()=>(s.value.filter(t=>t.leftBr).length+s.value.filter(t=>t.rightBr).length)%2!=0),g=()=>{s.value.push({column:"Title",op:"",value:"",rowop:" and ",leftBr:!1,rightBr:!1})};return te(s.value,()=>{let t="",e=s.value.filter(a=>a.value&&a.op||!a.value&&a.op=="Is null");for(const[a,n]of e.entries()){let l=p(n.column),r=l=="User"||l=="UserMulti"||l=="Lookup"||l=="LookupMulti"?n.column+"/Title":n.column,i="'"+n.value+"'";switch(l=="Number"?i=n.value:l=="DateTime"&&(i="datetime'"+n.value+"T00%3a00%3a00'"),n.leftBr&&!k.value&&(t+="("),n.op){case"Contains":t+="substringof("+i+","+r+")";break;case"Equal":t+=r+" eq "+i;break;case"Not equal":t+=r+" ne "+i;break;case"Less then":t+=r+" lt "+i;break;case"Greater than":t+=r+" gt "+i;break;case"Is null":t+=r+" eq null";break}n.rightBr&&!k.value&&(t+=")"),a<e.length-1&&(t+=n.rowop)}h&&clearTimeout(h),h=setTimeout(()=>{u("newSearchQuery",t)},1e3)},{deep:!0}),y({addFilter:g}),(t,e)=>s.value.length?(T(),F(oe,{key:0,style:{width:"100%"}},{default:f(()=>[v("thead",null,[v("tr",null,[Ve,Te,Ce,Ie,Be,Le,s.value.length>1?(T(),U("th",Ue," Connector ")):N("",!0)])]),v("tbody",null,[(T(!0),U(Q,null,D(s.value,(a,n)=>(T(),U("tr",{key:n},[v("td",null,[c(H,{color:"secondary"},{default:f(()=>[q("mdi-filter")]),_:1})]),v("td",null,[c(E,{modelValue:a.leftBr,"onUpdate:modelValue":l=>a.leftBr=l,disabled:k.value,ripple:!1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),v("td",null,[c($,{modelValue:a.column,"onUpdate:modelValue":l=>a.column=l,items:o.visibleColumns.filter(l=>l.type!="Note"&&l.type!="LookupTask"&&l.key!="AttachmentFiles").map(l=>({title:l.title,value:l.key}))},null,8,["modelValue","onUpdate:modelValue","items"])]),v("td",null,[c($,{modelValue:a.op,"onUpdate:modelValue":l=>a.op=l,items:I(a.column),required:"",rules:[l=>!!l||"This field is required"]},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),v("td",null,[z(c(le,{modelValue:a.value,"onUpdate:modelValue":l=>a.value=l,required:"",rules:[l=>!!l||"This field is required"],type:p(a.column)=="DateTime"?"date":"text"},null,8,["modelValue","onUpdate:modelValue","rules","type"]),[[ae,a.op!="Is null"]])]),v("td",null,[c(E,{modelValue:a.rightBr,"onUpdate:modelValue":l=>a.rightBr=l,disabled:!k.value,ripple:!1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),s.value.length>1?(T(),U("td",we,[n<s.value.length-1?(T(),F($,{key:0,modelValue:a.rowop,"onUpdate:modelValue":l=>a.rowop=l,items:[{title:"And (&&)",value:" and "},{title:"Or (||)",value:" or "}]},null,8,["modelValue","onUpdate:modelValue","items"])):N("",!0)])):N("",!0),v("td",null,[c(H,{small:"",onClick:l=>s.value.splice(n,1)},{default:f(()=>[q("mdi-delete")]),_:2},1032,["onClick"])])]))),128))])]),_:1})):N("",!0)}}),Fe=P(Ne,[["__file","dynamicFilters.vue"]]),Se=(o,y)=>{const u=V([]),m=V([]),s=V(!0),{getListColumnsInfo:h}=J(),p=V([]),I=B(()=>{let t=m.value.map(e=>e.type=="User"||e.type=="UserMulti"||e.type=="Lookup"||e.type=="LookupMulti"?e.key+"/Id":e.key).filter(e=>e!="actions"&&e!="AttachmentFiles");for(let e of m.value)e.type=="User"||e.type=="UserMulti"||e.type=="Lookup"||e.type=="LookupMulti"?(t.push(e.key+"/Title"),p.value.push(e.key)):e.key=="AttachmentFiles"&&(t.push(e.key+"/FileName"),t.push(e.key+"/ServerRelativeUrl"),p.value.push(e.key));return t}),k=B(()=>m.value.filter(t=>t.key!="actions"&&t.align!=" d-none"));return{initTable:async()=>{u.value=await h(o),m.value=y.map(t=>{const e=u.value.find(n=>n.staticName==t.key);let a=t;return e&&(a={key:t.key,title:t.title?t.title:e==null?void 0:e.label,type:e.type?e.type:t.type,format:e.format,sortable:e.type!="Note",choices:e.choices}),a}),s.value=!1},tableHeaders:m,initLoading:s,selectColumns:I,expandColumns:p,visibleColumns:k}},qe=(o,y,u)=>{const m=se("$mainUrl"),s=V([]),h=V(""),p=V(!1),I=V([]),k=V([]),g=V(y),t=V(""),e=l=>l.map(r=>r.key+" "+r.order).join(","),a=B(()=>u&&t.value?`(${u}) and (${t.value})`:u||(t.value?t.value:""));return{items:s,getData:async l=>{p.value=!0;const r=l?await j.get(l):await j.get(m+"/_api/web/lists/getbytitle('"+o+"')/items",{params:{$expand:k.value.join(","),$select:I.value.join(","),$orderby:g.value&&g.value.length?e(g.value):void 0,$filter:a.value?a.value:void 0,$top:10}});if(r.data["odata.nextLink"]?h.value=r.data["odata.nextLink"]:h.value="",l){const i=new Map;s.value.forEach(_=>i.set(_.Id,_)),r.data.value.forEach(_=>i.set(_.Id,{...i.get(_.Id),..._})),s.value=Array.from(i.values())}else s.value=r.data.value;s.value=s.value.map(i=>("AttachmentFiles"in i&&(i.AttachmentFiles=i.AttachmentFiles.map(_=>Object.assign(_,{list:o,id:_.ServerRelativeUrl,itemId:i.Id,title:i.Title,file:_.FileName.includes(".")?_.FileName.split(".").pop().toLowerCase():void 0}))),i)),console.log(s.value),p.value=!1},nextPage:h,dataLoading:p,selectColumnsData:I,expandColumnsData:k,currentSortBy:g,currentFilter:t}};const $e=ne({id:String,text:String,...ie(re({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),xe=ue()({name:"VTooltip",props:$e(),emits:{"update:modelValue":o=>!0},setup(o,y){let{slots:u}=y;const m=ce(o,"modelValue"),{scopeId:s}=de(),h=me(),p=B(()=>o.id||`v-tooltip-${h}`),I=V(),k=B(()=>o.location.split(" ").length>1?o.location:o.location+" center"),g=B(()=>o.origin==="auto"||o.origin==="overlap"||o.origin.split(" ").length>1||o.location.split(" ").length>1?o.origin:o.origin+" center"),t=B(()=>o.transition?o.transition:m.value?"scale-transition":"fade-transition"),e=B(()=>M({"aria-describedby":p.value},o.activatorProps));return pe(()=>{const[a]=R.filterProps(o);return c(R,M({ref:I,class:["v-tooltip",o.class],style:o.style,id:p.value},a,{modelValue:m.value,"onUpdate:modelValue":n=>m.value=n,transition:t.value,absolute:!0,location:k.value,origin:g.value,persistent:!0,role:"tooltip",activatorProps:e.value,_disableGlobalStack:!0},s),{activator:u.activator,default:function(){var i;for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return((i=u.default)==null?void 0:i.call(u,...l))??o.text}})}),ve({},I)}}),Ae={key:0},De=["innerHTML"],He={key:2},Me=O({__name:"listTable",props:{listName:{type:String,required:!0},sortBy:{type:Array,default:[{key:"Id",order:"asc"}]},tableHeadersInit:{type:Array,default:[{key:"Id",title:"Id"},{key:"Title"}]},actions:Array},setup(o){const y=o,u=V(null),{initTable:m,tableHeaders:s,initLoading:h,selectColumns:p,expandColumns:I,visibleColumns:k}=Se(y.listName,y.tableHeadersInit),{getData:g,dataLoading:t,items:e,nextPage:a,selectColumnsData:n,expandColumnsData:l,currentSortBy:r,currentFilter:i}=qe(y.listName,y.sortBy),{parseColVal:_}=J();fe(async()=>{await m(),n.value=p.value,l.value=I.value});const W=async({sortBy:L})=>{r.value=L,g()},X=L=>{i.value=L,g()},Y=(L,w)=>{let S=L.value.split("/");return w[S[0]]?_(L.type,w[S[0]][S[1]],L.format):""};return(L,w)=>{const S=Fe,Z=ye("v-data-table-server");return b(h)?N("",!0):(T(),F(K,{key:0,loading:b(h)},{default:f(()=>[c(A,null,{default:f(()=>[c(he,{flat:""},{default:f(()=>[c(be),c(G,{class:"ma-2",color:"primary",icon:"mdi-filter-plus",onClick:w[0]||(w[0]=d=>{var C;return(C=u.value)==null?void 0:C.addFilter()})})]),_:1})]),_:1}),c(A,null,{default:f(()=>[c(S,{"visible-columns":b(k),ref_key:"filtersRef",ref:u,onNewSearchQuery:X},null,8,["visible-columns"])]),_:1}),c(A,null,{default:f(()=>[c(Z,{"items-per-page":"-1","items-length":"-1",headers:b(s),items:b(e),loading:b(t),"sort-by":o.sortBy,"onUpdate:options":W,class:"elevation-1","item-value":"Id"},ke({"item.actions":f(({item:d})=>[(T(!0),U(Q,null,D(o.actions,C=>(T(),F(xe,{key:C.icon,bottom:"",text:C.hintText},{activator:f(({props:ee})=>[c(H,M({color:C.color,onClick:Ee=>C.click(d.columns),style:{"margin-right":"2px"}},ee),{default:f(()=>[q(x(C.icon),1)]),_:2},1040,["color","onClick"])]),_:2},1032,["text"]))),128))]),bottom:f(()=>[b(a)?z((T(),F(G,{key:0,onClick:w[1]||(w[1]=d=>b(g)(b(a)))},{default:f(()=>[q(" Load more ")]),_:1})),[[ge,d=>{d&&b(g)(b(a))}]]):N("",!0)]),_:2},[D(b(k).filter(d=>d.key!="Attachments"&&d.key!="AttachmentFiles"),d=>({name:`item.${d.key}`,fn:f(({item:C})=>[d.key.includes("/")?(T(),U("span",Ae,x(Y(d,C.columns)),1)):d.format=="FullHtml"?(T(),U("span",{key:1,innerHTML:C.columns[d.key]},null,8,De)):(T(),U("span",He,x(b(_)(d.type,C.columns[d.key],d.format)),1))])}))]),1032,["headers","items","loading","sort-by"])]),_:1})]),_:1},8,["loading"]))}}}),Oe=P(Me,[["__file","listTable.vue"]]),Pe=O({__name:"Home",setup(o){const y=_e();return(u,m)=>(T(),F(K,{fluid:""},{default:f(()=>[c(Oe,{listName:"Lista Testowa",tableHeadersInit:[{key:"Id",title:"Id",align:" d-none"},{key:"actions",title:"Actions",sortable:!1},{key:"Title"},{key:"PackedDate"},{key:"Liczby"}],actions:[{icon:"mdi-text-box",color:"primary",hintText:"Open",click:s=>{b(y).push({name:"form",params:{id:s.Id}})}}]},null,8,["actions"])]),_:1}))}}),Ge=P(Pe,[["__file","Home.vue"]]);export{Ge as default};
